---
title: "Assignment 9"
author: "Jonathan Flores"
date: "March 6, 2018"
output: html_document
---



## Harry Potter Cast

Question 1 - In the IMDB, there are listings of full cast members for movies. Navigate to http://www.imdb.com/title/tt1201607/fullcredits?ref_=tt_ql_1. Feel free to View Source to get a good idea of what the page looks like in code.

``` {r echo=TRUE, results='asis'}


url <- 'http://www.imdb.com/title/tt1201607/fullcredits?ref_=tt_ql_1'

## Loading Library to read html

library(rvest)

## Assign URL to variable

webpage <- read_html(url)

```


## Question 1.b

Scrape the page with any R package that makes things easy for you. Of particular interest is the table of the Cast in order of crediting. Please scrape this table (you might have to fish it out of several of the tables from the page) and make it a data.frame() of the Cast in your R environment


```{r echo=TRUE, results='asis'}

## Load respective libraries: magrittr to extract tables within html format, kntir to format tables in html and stringr to parse the words within a column


library(magrittr)
library(knitr)
library(stringr)


## Review the nodes on the webpage

nodestable <- html_nodes(webpage,'table')

```


## Question 1.c - d

Clean up the table
. It should not have blank observations or rows, a row that should be column names, or just '.'
. It should have intuitive column names (ideally 2 to start - Actor and Character)
. In the film, Mr. Warwick plays two characters, which makes his row look a little weird. Please replace his character column with just "Griphook / Professor Filius Flitwick" to make it look better. . One row might result in "Rest of cast listed alphabetically" - remove this observation.


```{r echo=TRUE,results='asis'}

## Drill down to the relevant table and naming it castlist

castall <- html_table(webpage)%>%
  extract2(3)

## Removing blanks from cast

castlist <- castall$X2[-1]

## Removing "Rest of cast listed alphabetically"

castlist2 <- castall$X2[-93]

## Extracting First Name - Raw

ActorName1 <- word(castlist2,1)
FirstName <-ActorName1[-1]

## Extracting Surname Name - Raw

ActorName2 <- word(castlist2,2)
Surname <-ActorName2[-1]


## Binding Names

ActorNames <- cbind(FirstName,Surname)

## Name Corrections for those Actors that have 3 names

ActorNames[12,1] <- 'Helena Bonham'
ActorNames[12,2] <- 'Carter'
ActorNames[36,1] <- 'Sian Grace'
ActorNames[36,2] <- 'Phillips'
ActorNames[78,1] <- 'Peter G'
ActorNames[78,2] <- 'Reed'
ActorNames[81,1] <- 'Bob Ives Van'
ActorNames[81,2] <- 'Hellenberg Hubar'
ActorNames[86,1] <- 'Daphne'
ActorNames[86,2] <- 'de Beistegui'
ActorNames[95,1] <- 'Michael Henbury'
ActorNames[95,2] <- 'Ballan'
ActorNames[106,1] <- 'Gioachinno Jim'
ActorNames[106,2] <- 'BCuffaro'
ActorNames[111,1] <- 'Grace Meurisse'
ActorNames[111,2] <- 'Francis'
ActorNames[112,1] <- 'Sean Francis'
ActorNames[112,2] <- 'George'
ActorNames[134,1] <- 'Sara Jane'
ActorNames[134,2] <- "O'Neill"


## Display First Section of the Table

colnames(ActorNames,c("FirstName","Surname"))
knitr::kable(head(ActorNames,12))


## Assigning character and removing blanks

characterraw <- castall$X4[-1]

## Removing "Rest of cast listed alphabetically"

Character <- characterraw[-92]
knitr::kable(head(Character))

## Extracting First and Second of Character Field

CastTable <- cbind(ActorNames,Character)

## Fix Records

CastTable[10,3] <- "Griphook/Professor Filius Flitwick"
CastTable[22,3] <- "Hogsmeade Death Eater as Benjamin Northover"
CastTable[33,3] <- "Dean Thomas as Alfred Enoch"
CastTable[69,3] <- "The sorting hat voice"
CastTable[87,3] <- "Lilly Potter 19 years later"
CastTable[88,3] <- "James Potter 19 years later"
```

## Question 1.e

Present the first 10 rows of the data.frame() - It should have only FirstName, Surname, and Character columns.


```{r echo=TRUE, results='asis'}

knitr::kable(head(CastTable,10))

```

## SportsBall 2.a and 2.b

On the ESPN website, there are statistics of each NBA player. Navigate to the San Antonio Spurs current statistics (likely http://www.espn.com/nba/team/stats/_/name/sa/san-antonio-spurs) 
You are interested in the Shooting Statistics table.

``` {r echo=TRUE, results='asis'}

spursurl <- 'http://www.espn.com/nba/team/stats/_/name/sa/san-antonio-spurs'

webpagespurs <- read_html(spursurl)

spursnodestable <- html_nodes(webpagespurs,'table')

shootingtable <- html_table(webpagespurs,header =TRUE )%>%
  extract2(2)

names(shootingtable)[1:15] <- c("PLAYER", "FGM","FGA","FG%","3PM","3PA","3P%","FTM","FTA","FT%","2PM","2PA","2P%","PPS","AFG%")


nbashooting=shootingtable[-1,]

knitr::kable(nbashooting)


```


## Question 2.c

Clean up the table (You might get some warnings if you're working with tibbles)
. You'll want to create an R data.frame() with one observation for each player. Make sure that you do not accidentally include blank rows, a row of column names, or the Totals row in the table as observations.
. The column PLAYER has two variables of interest in it: the player's name and their position, denoted by 1-2 letters after their name. Split the cells into two columns, one with Name and the other Position.
. Check the data type of all columns. Convert relevant columns to numeric. Check the data type of all columns again to confirm that they have changed!

```{r echo=TRUE, resuts='asis'}

## REMOVING THE COMMA FROM THE PLAYER COLUMN

PLAYER <- gsub("[[:punct:]]", "", nbashooting$PLAYER)

## SEPARATING THE PLAYER COLUMN INTO TWO COUMNS: NAME AND POSITION

NAME <- word(PLAYER,1,2)
POSITION <- word(PLAYER,3)

## FIXING RECORDS

NAME[18]<-"TOTALS"
POSITION[18]<-" "

## CREATING NEW DATA FRAME AND BINDING THE 2 NEW CREATED COLUMNS

playerandposition <- cbind(NAME,POSITION)
nbashooting1 <- nbashooting[-1]
nbashooting1 <- cbind(playerandposition,nbashooting1)
knitr::kable(nbashooting1)

```

## Question 2.d

Create a colorful bar chart that shows the Field Goals Percentage Per Game for each person. It will be graded on the following criteria.
. Informative Title, centered
. Relevant x and y axis labels (not simply variables names!)
. Human-readable axes with no overlap (you might have to flip x and y to fix that). Note: You do not have to convert the decimal to a percentage.
. Color the columns by the team member's position (so, all PF's should have the same color, etc.)


```{r echo=TRUE, results='asis'}

## Loading libraries

library(plotly)
library(rlang)

## Removing Totals row to create chart

nbashooting2 <-nbashooting1[-18,]
knitr::kable(nbashooting2)

## Chart creation

plotly::plot_ly(x=nbashooting2$"FG%",y=nbashooting2$NAME,type = 'bar',orientation='h',color = nbashooting2$POSITION)%>%
  layout(title="Field Goals Percentage per Game",xaxis=list(title="Field Goals Percentage per Game",yaxis=list(title="NBA Players")),font=list(size=8))


```


